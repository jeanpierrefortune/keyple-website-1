<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="5437.5px" preserveAspectRatio="none" style="width:4222px;height:5437px;" version="1.1" viewBox="0 0 4222 5437" width="4222.5px" zoomAndPan="magnify"><defs><filter height="1" id="b114w9tenn9awv0" width="1" x="0" y="0"><feFlood flood-color="#ADD8E6" result="flood"/><feComposite in="SourceGraphic" in2="flood" operator="over"/></filter></defs><g><rect fill="#FEF9E7" height="5358.2617" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 2.5;" width="2072.5" x="315" y="10"/><text fill="#000000" font-family="sans-serif" font-size="32.5" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="435" x="1133.75" y="43.7378">Client APP using Native Lib</text><rect fill="#FDF2E9" height="5358.2617" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 2.5;" width="1710" x="2392.5" y="10"/><text fill="#000000" font-family="sans-serif" font-size="32.5" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="452.5" x="3021.25" y="43.7378">Server APP using Virtual Lib</text><rect fill="#FFFFE0" height="3332.5586" style="stroke: #A80036; stroke-width: 2.5;" width="25" x="101.25" y="1760.1563"/><rect fill="#ADD8E6" height="303.5156" style="stroke: #A80036; stroke-width: 2.5;" width="25" x="496.25" y="1760.1563"/><rect fill="#ADD8E6" height="116.5234" style="stroke: #A80036; stroke-width: 2.5;" width="25" x="842.5" y="1088.3594"/><rect fill="#ADD8E6" height="75.8789" style="stroke: #A80036; stroke-width: 2.5;" width="25" x="842.5" y="1500.0195"/><rect fill="#FFC0CB" height="4376.0156" style="stroke: #A80036; stroke-width: 2.5;" width="25" x="1450" y="716.6992"/><rect fill="#ADD8E6" height="2398.6328" style="stroke: #A80036; stroke-width: 2.5;" width="25" x="2172.5" y="2671.582"/><rect fill="#ADD8E6" height="182.4023" style="stroke: #A80036; stroke-width: 2.5;" width="25" x="2590" y="2706.582"/><rect fill="#ADD8E6" height="75.8789" style="stroke: #A80036; stroke-width: 2.5;" width="25" x="2590" y="2964.8633"/><rect fill="#ADD8E6" height="110.8789" style="stroke: #A80036; stroke-width: 2.5;" width="25" x="2590" y="4883.457"/><rect fill="#ADD8E6" height="75.8789" style="stroke: #A80036; stroke-width: 2.5;" width="25" x="3126.25" y="3116.6211"/><rect fill="#ADD8E6" height="75.8789" style="stroke: #A80036; stroke-width: 2.5;" width="25" x="3126.25" y="3677.7734"/><rect fill="#ADD8E6" height="75.8789" style="stroke: #A80036; stroke-width: 2.5;" width="25" x="3126.25" y="3870.4102"/><rect fill="#ADD8E6" height="35" style="stroke: #A80036; stroke-width: 2.5;" width="25" x="3126.25" y="4022.168"/><rect fill="#ADD8E6" height="227.6367" style="stroke: #A80036; stroke-width: 2.5;" width="25" x="3126.25" y="4454.0625"/><rect fill="#FFC0CB" height="4761.2891" style="stroke: #A80036; stroke-width: 2.5;" width="25" x="3771.25" y="331.4258"/><rect fill="#FDF2E9" height="498.6523" rx="12.5" ry="12.5" style="stroke: #000000; stroke-width: 5.0;" width="4106.25" x="32.5" y="4203.0469"/><line style="stroke: #A80036; stroke-width: 2.5; stroke-dasharray: 5.0,5.0;" x1="112.5" x2="112.5" y1="306.4258" y2="5115.2148"/><line style="stroke: #A80036; stroke-width: 2.5; stroke-dasharray: 5.0,5.0;" x1="507.5" x2="507.5" y1="1161.6211" y2="5115.2148"/><line style="stroke: #A80036; stroke-width: 2.5; stroke-dasharray: 5.0,5.0;" x1="855" x2="855" y1="1049.9805" y2="5115.2148"/><line style="stroke: #A80036; stroke-width: 2.5; stroke-dasharray: 5.0,5.0;" x1="1462.5" x2="1462.5" y1="306.4258" y2="5115.2148"/><line style="stroke: #A80036; stroke-width: 2.5; stroke-dasharray: 5.0,5.0;" x1="2185" x2="2185" y1="938.3398" y2="5115.2148"/><line style="stroke: #A80036; stroke-width: 2.5; stroke-dasharray: 5.0,5.0;" x1="2602.5" x2="2602.5" y1="546.123" y2="5115.2148"/><line style="stroke: #A80036; stroke-width: 2.5; stroke-dasharray: 5.0,5.0;" x1="3137.5" x2="3137.5" y1="2804.8438" y2="5115.2148"/><line style="stroke: #A80036; stroke-width: 2.5; stroke-dasharray: 5.0,5.0;" x1="3782.5" x2="3782.5" y1="306.4258" y2="5115.2148"/><rect fill="#FEFECE" height="79.0234" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 3.75;" width="112.5" x="57.5" y="224.9023"/><text fill="#000000" font-family="sans-serif" font-size="35" lengthAdjust="spacingAndGlyphs" textLength="77.5" x="75" y="278.7354">Card</text><rect fill="#FEFECE" height="79.0234" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 3.75;" width="112.5" x="57.5" y="5112.7148"/><text fill="#000000" font-family="sans-serif" font-size="35" lengthAdjust="spacingAndGlyphs" textLength="77.5" x="75" y="5166.5479">Card</text><rect fill="#ADD8E6" height="79.0234" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 3.75;" width="367.5" x="325" y="5112.7148"/><text fill="#000000" font-family="sans-serif" font-size="35" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="332.5" x="342.5" y="5166.5479">ObservableReader</text><rect fill="#ADD8E6" height="79.0234" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 3.75;" width="145" x="782.5" y="5112.7148"/><text fill="#000000" font-family="sans-serif" font-size="35" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="110" x="800" y="5166.5479">Plugin</text><text fill="#000000" font-family="sans-serif" font-size="35" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="305" x="1302.5" y="298.7354">Ticketing Service</text><ellipse cx="1462.5" cy="129.9023" fill="#FEFECE" rx="20" ry="20" style="stroke: #A80036; stroke-width: 5.0;"/><path d="M1462.5,149.9023 L1462.5,217.4023 M1430,169.9023 L1495,169.9023 M1462.5,217.4023 L1430,254.9023 M1462.5,217.4023 L1495,254.9023 " fill="none" style="stroke: #A80036; stroke-width: 5.0;"/><text fill="#000000" font-family="sans-serif" font-size="35" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="305" x="1302.5" y="5149.0479">Ticketing Service</text><ellipse cx="1462.5" cy="5181.7383" fill="#FEFECE" rx="20" ry="20" style="stroke: #A80036; stroke-width: 5.0;"/><path d="M1462.5,5201.7383 L1462.5,5269.2383 M1430,5221.7383 L1495,5221.7383 M1462.5,5269.2383 L1430,5306.7383 M1462.5,5269.2383 L1495,5306.7383 " fill="none" style="stroke: #A80036; stroke-width: 5.0;"/><rect fill="#ADD8E6" height="79.0234" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 3.75;" width="385" x="1992.5" y="5112.7148"/><text fill="#000000" font-family="sans-serif" font-size="35" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="350" x="2010" y="5166.5479">NativeClientService</text><rect fill="#ADD8E6" height="79.0234" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 3.75;" width="400" x="2402.5" y="5112.7148"/><text fill="#000000" font-family="sans-serif" font-size="35" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="365" x="2420" y="5166.5479">RemoteServerPlugin</text><rect fill="#ADD8E6" height="79.0234" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 3.75;" width="622.5" x="2827.5" y="5112.7148"/><text fill="#000000" font-family="sans-serif" font-size="35" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="587.5" x="2845" y="5166.5479">RemoteServerObservableReader</text><text fill="#000000" font-family="sans-serif" font-size="35" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="450" x="3546.25" y="254.7119">Remote Ticketing Service</text><text fill="#000000" font-family="sans-serif" font-size="35" lengthAdjust="spacingAndGlyphs" textLength="10" x="3996.25" y="254.7119">:</text><text fill="#000000" filter="url(#b114w9tenn9awv0)" font-family="sans-serif" font-size="35" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="602.5" x="3475" y="298.7354">ObservablePlugin.PluginObserver</text><ellipse cx="3783.75" cy="85.8789" fill="#FEFECE" rx="20" ry="20" style="stroke: #A80036; stroke-width: 5.0;"/><path d="M3783.75,105.8789 L3783.75,173.3789 M3751.25,125.8789 L3816.25,125.8789 M3783.75,173.3789 L3751.25,210.8789 M3783.75,173.3789 L3816.25,210.8789 " fill="none" style="stroke: #A80036; stroke-width: 5.0;"/><text fill="#000000" font-family="sans-serif" font-size="35" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="450" x="3546.25" y="5149.0479">Remote Ticketing Service</text><text fill="#000000" font-family="sans-serif" font-size="35" lengthAdjust="spacingAndGlyphs" textLength="10" x="3996.25" y="5149.0479">:</text><text fill="#000000" filter="url(#b114w9tenn9awv0)" font-family="sans-serif" font-size="35" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="602.5" x="3475" y="5193.0713">ObservablePlugin.PluginObserver</text><ellipse cx="3783.75" cy="5225.7617" fill="#FEFECE" rx="20" ry="20" style="stroke: #A80036; stroke-width: 5.0;"/><path d="M3783.75,5245.7617 L3783.75,5313.2617 M3751.25,5265.7617 L3816.25,5265.7617 M3783.75,5313.2617 L3751.25,5350.7617 M3783.75,5313.2617 L3816.25,5350.7617 " fill="none" style="stroke: #A80036; stroke-width: 5.0;"/><rect fill="#FFFFE0" height="3332.5586" style="stroke: #A80036; stroke-width: 2.5;" width="25" x="101.25" y="1760.1563"/><rect fill="#ADD8E6" height="303.5156" style="stroke: #A80036; stroke-width: 2.5;" width="25" x="496.25" y="1760.1563"/><rect fill="#ADD8E6" height="116.5234" style="stroke: #A80036; stroke-width: 2.5;" width="25" x="842.5" y="1088.3594"/><rect fill="#ADD8E6" height="75.8789" style="stroke: #A80036; stroke-width: 2.5;" width="25" x="842.5" y="1500.0195"/><rect fill="#FFC0CB" height="4376.0156" style="stroke: #A80036; stroke-width: 2.5;" width="25" x="1450" y="716.6992"/><rect fill="#ADD8E6" height="2398.6328" style="stroke: #A80036; stroke-width: 2.5;" width="25" x="2172.5" y="2671.582"/><rect fill="#ADD8E6" height="182.4023" style="stroke: #A80036; stroke-width: 2.5;" width="25" x="2590" y="2706.582"/><rect fill="#ADD8E6" height="75.8789" style="stroke: #A80036; stroke-width: 2.5;" width="25" x="2590" y="2964.8633"/><rect fill="#ADD8E6" height="110.8789" style="stroke: #A80036; stroke-width: 2.5;" width="25" x="2590" y="4883.457"/><rect fill="#ADD8E6" height="75.8789" style="stroke: #A80036; stroke-width: 2.5;" width="25" x="3126.25" y="3116.6211"/><rect fill="#ADD8E6" height="75.8789" style="stroke: #A80036; stroke-width: 2.5;" width="25" x="3126.25" y="3677.7734"/><rect fill="#ADD8E6" height="75.8789" style="stroke: #A80036; stroke-width: 2.5;" width="25" x="3126.25" y="3870.4102"/><rect fill="#ADD8E6" height="35" style="stroke: #A80036; stroke-width: 2.5;" width="25" x="3126.25" y="4022.168"/><rect fill="#ADD8E6" height="227.6367" style="stroke: #A80036; stroke-width: 2.5;" width="25" x="3126.25" y="4454.0625"/><rect fill="#FFC0CB" height="4761.2891" style="stroke: #A80036; stroke-width: 2.5;" width="25" x="3771.25" y="331.4258"/><rect fill="#EEEEEE" height="7.5" style="stroke: #EEEEEE; stroke-width: 2.5;" width="4186.25" x="7.5" y="384.3652"/><line style="stroke: #000000; stroke-width: 2.5;" x1="7.5" x2="4193.75" y1="384.3652" y2="384.3652"/><line style="stroke: #000000; stroke-width: 2.5;" x1="7.5" x2="4193.75" y1="391.8652" y2="391.8652"/><rect fill="#EEEEEE" height="60.8789" style="stroke: #000000; stroke-width: 5.0;" width="417.5" x="1891.875" y="356.4258"/><text fill="#000000" font-family="sans-serif" font-size="32.5" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="372.5" x="1906.875" y="400.1636">Virtual Lib Initialization</text><polygon fill="#A80036" points="2830,569.9414,2805,579.9414,2830,589.9414,2820,579.9414" style="stroke: #A80036; stroke-width: 2.5;"/><line style="stroke: #A80036; stroke-width: 2.5;" x1="2815" x2="3768.75" y1="579.9414" y2="579.9414"/><text fill="#000000" font-family="sans-serif" font-size="32.5" lengthAdjust="spacingAndGlyphs" textLength="462.5" x="2845" y="486.0425">smartCardService.registerPlugin</text><text fill="#000000" font-family="sans-serif" font-size="32.5" lengthAdjust="spacingAndGlyphs" textLength="442.5" x="2855" y="526.9214">(RemoteServerPluginFactory...</text><text fill="#000000" font-family="sans-serif" font-size="32.5" lengthAdjust="spacingAndGlyphs" textLength="407.5" x="2885" y="567.8003">.withPluginObserver (this)...)</text><rect fill="#ADD8E6" height="79.0234" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 3.75;" width="400" x="2402.5" y="493.418"/><text fill="#000000" font-family="sans-serif" font-size="35" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="365" x="2420" y="547.251">RemoteServerPlugin</text><line style="stroke: #A80036; stroke-width: 2.5;" x1="3796.25" x2="3913.75" y1="684.1992" y2="684.1992"/><line style="stroke: #A80036; stroke-width: 2.5;" x1="3913.75" x2="3913.75" y1="684.1992" y2="716.6992"/><line style="stroke: #A80036; stroke-width: 2.5;" x1="3811.25" x2="3913.75" y1="716.6992" y2="716.6992"/><polygon fill="#A80036" points="3836.25,706.6992,3811.25,716.6992,3836.25,726.6992,3826.25,716.6992" style="stroke: #A80036; stroke-width: 2.5;"/><text fill="#000000" font-family="sans-serif" font-size="32.5" lengthAdjust="spacingAndGlyphs" textLength="265" x="3826.25" y="631.1792">Awaiting receipt of</text><text fill="#000000" font-family="sans-serif" font-size="32.5" lengthAdjust="spacingAndGlyphs" textLength="237.5" x="3836.25" y="672.0581">a Plugin Event...</text><rect fill="#EEEEEE" height="7.5" style="stroke: #EEEEEE; stroke-width: 2.5;" width="4186.25" x="7.5" y="802.1387"/><line style="stroke: #000000; stroke-width: 2.5;" x1="7.5" x2="4193.75" y1="802.1387" y2="802.1387"/><line style="stroke: #000000; stroke-width: 2.5;" x1="7.5" x2="4193.75" y1="809.6387" y2="809.6387"/><rect fill="#EEEEEE" height="60.8789" style="stroke: #000000; stroke-width: 5.0;" width="412.5" x="1894.375" y="774.1992"/><text fill="#000000" font-family="sans-serif" font-size="32.5" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="367.5" x="1909.375" y="817.937">Native Lib Initialization</text><polygon fill="#A80036" points="1962.5,905.957,1987.5,915.957,1962.5,925.957,1972.5,915.957" style="stroke: #A80036; stroke-width: 2.5;"/><line style="stroke: #A80036; stroke-width: 2.5;" x1="1475" x2="1977.5" y1="915.957" y2="915.957"/><text fill="#000000" font-family="sans-serif" font-size="32.5" lengthAdjust="spacingAndGlyphs" textLength="415" x="1492.5" y="903.8159">NativeClientServiceFactory...</text><rect fill="#ADD8E6" height="79.0234" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 3.75;" width="385" x="1992.5" y="860.0781"/><text fill="#000000" font-family="sans-serif" font-size="35" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="350" x="2010" y="913.9111">NativeClientService</text><polygon fill="#A80036" points="955,1053.3594,930,1063.3594,955,1073.3594,945,1063.3594" style="stroke: #A80036; stroke-width: 2.5;"/><line style="stroke: #A80036; stroke-width: 2.5;" x1="940" x2="1447.5" y1="1063.3594" y2="1063.3594"/><text fill="#000000" font-family="sans-serif" font-size="32.5" lengthAdjust="spacingAndGlyphs" textLength="462.5" x="970" y="1010.3394">smartCardService.registerPlugin</text><text fill="#000000" font-family="sans-serif" font-size="32.5" lengthAdjust="spacingAndGlyphs" textLength="270" x="980" y="1051.2183">(new XXXFactory())</text><rect fill="#ADD8E6" height="79.0234" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 3.75;" width="145" x="782.5" y="976.8359"/><text fill="#000000" font-family="sans-serif" font-size="35" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="110" x="800" y="1030.6689">Plugin</text><polygon fill="#A80036" points="720,1129.2383,695,1139.2383,720,1149.2383,710,1139.2383" style="stroke: #A80036; stroke-width: 2.5;"/><line style="stroke: #A80036; stroke-width: 2.5;" x1="705" x2="840" y1="1139.2383" y2="1139.2383"/><text fill="#000000" font-family="sans-serif" font-size="32.5" lengthAdjust="spacingAndGlyphs" textLength="90" x="735" y="1127.0972">create</text><rect fill="#ADD8E6" height="79.0234" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 3.75;" width="367.5" x="325" y="1083.3594"/><text fill="#000000" font-family="sans-serif" font-size="35" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="332.5" x="342.5" y="1137.1924">ObservableReader</text><polygon fill="#A80036" points="1420,1194.8828,1445,1204.8828,1420,1214.8828,1430,1204.8828" style="stroke: #A80036; stroke-width: 2.5;"/><line style="stroke: #A80036; stroke-width: 2.5; stroke-dasharray: 2.0,2.0;" x1="855" x2="1435" y1="1204.8828" y2="1204.8828"/><rect fill="#EEEEEE" height="7.5" style="stroke: #EEEEEE; stroke-width: 2.5;" width="4186.25" x="7.5" y="1277.8223"/><line style="stroke: #000000; stroke-width: 2.5;" x1="7.5" x2="4193.75" y1="1277.8223" y2="1277.8223"/><line style="stroke: #000000; stroke-width: 2.5;" x1="7.5" x2="4193.75" y1="1285.3223" y2="1285.3223"/><rect fill="#EEEEEE" height="60.8789" style="stroke: #000000; stroke-width: 5.0;" width="380" x="1910.625" y="1249.8828"/><text fill="#000000" font-family="sans-serif" font-size="32.5" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="335" x="1925.625" y="1293.6206">Native CardSelection</text><line style="stroke: #A80036; stroke-width: 2.5;" x1="1475" x2="1580" y1="1391.6406" y2="1391.6406"/><line style="stroke: #A80036; stroke-width: 2.5;" x1="1580" x2="1580" y1="1391.6406" y2="1424.1406"/><line style="stroke: #A80036; stroke-width: 2.5;" x1="1477.5" x2="1580" y1="1424.1406" y2="1424.1406"/><polygon fill="#A80036" points="1502.5,1414.1406,1477.5,1424.1406,1502.5,1434.1406,1492.5,1424.1406" style="stroke: #A80036; stroke-width: 2.5;"/><text fill="#000000" font-family="sans-serif" font-size="32.5" lengthAdjust="spacingAndGlyphs" textLength="325" x="1492.5" y="1379.4995">Start Ticketing Service</text><polygon fill="#A80036" points="895,1490.0195,870,1500.0195,895,1510.0195,885,1500.0195" style="stroke: #A80036; stroke-width: 2.5;"/><line style="stroke: #A80036; stroke-width: 2.5;" x1="880" x2="1447.5" y1="1500.0195" y2="1500.0195"/><text fill="#000000" font-family="sans-serif" font-size="32.5" lengthAdjust="spacingAndGlyphs" textLength="257.5" x="910" y="1487.8784">getReader (name)</text><polygon fill="#A80036" points="1420,1565.8984,1445,1575.8984,1420,1585.8984,1430,1575.8984" style="stroke: #A80036; stroke-width: 2.5;"/><line style="stroke: #A80036; stroke-width: 2.5; stroke-dasharray: 2.0,2.0;" x1="855" x2="1435" y1="1575.8984" y2="1575.8984"/><text fill="#000000" font-family="sans-serif" font-size="32.5" lengthAdjust="spacingAndGlyphs" textLength="90" x="872.5" y="1563.7573">reader</text><line style="stroke: #A80036; stroke-width: 2.5;" x1="1475" x2="1580" y1="1651.7773" y2="1651.7773"/><line style="stroke: #A80036; stroke-width: 2.5;" x1="1580" x2="1580" y1="1651.7773" y2="1684.2773"/><line style="stroke: #A80036; stroke-width: 2.5;" x1="1477.5" x2="1580" y1="1684.2773" y2="1684.2773"/><polygon fill="#A80036" points="1502.5,1674.2773,1477.5,1684.2773,1502.5,1694.2773,1492.5,1684.2773" style="stroke: #A80036; stroke-width: 2.5;"/><text fill="#000000" font-family="sans-serif" font-size="32.5" lengthAdjust="spacingAndGlyphs" textLength="430" x="1492.5" y="1639.6362">prepareCardSelection (reader)</text><polygon fill="#A80036" points="548.75,1750.1563,523.75,1760.1563,548.75,1770.1563,538.75,1760.1563" style="stroke: #A80036; stroke-width: 2.5;"/><line style="stroke: #A80036; stroke-width: 2.5;" x1="533.75" x2="1447.5" y1="1760.1563" y2="1760.1563"/><text fill="#000000" font-family="sans-serif" font-size="32.5" lengthAdjust="spacingAndGlyphs" textLength="397.5" x="563.75" y="1748.0151">setCardSelectionRequest ()</text><line style="stroke: #A80036; stroke-width: 2.5;" x1="491.25" x2="466.25" y1="1836.0352" y2="1826.0352"/><line style="stroke: #A80036; stroke-width: 2.5;" x1="491.25" x2="466.25" y1="1836.0352" y2="1846.0352"/><line style="stroke: #A80036; stroke-width: 2.5;" x1="126.25" x2="493.75" y1="1836.0352" y2="1836.0352"/><text fill="#000000" font-family="sans-serif" font-size="32.5" lengthAdjust="spacingAndGlyphs" textLength="310" x="143.75" y="1823.894">SE_MATCHED Event</text><polygon fill="#A80036" points="153.75,1901.9141,128.75,1911.9141,153.75,1921.9141,143.75,1911.9141" style="stroke: #A80036; stroke-width: 2.5;"/><line style="stroke: #A80036; stroke-width: 2.5;" x1="138.75" x2="493.75" y1="1911.9141" y2="1911.9141"/><text fill="#000000" font-family="sans-serif" font-size="32.5" lengthAdjust="spacingAndGlyphs" textLength="122.5" x="168.75" y="1899.7729">C-APDU</text><polygon fill="#A80036" points="466.25,1977.793,491.25,1987.793,466.25,1997.793,476.25,1987.793" style="stroke: #A80036; stroke-width: 2.5;"/><line style="stroke: #A80036; stroke-width: 2.5; stroke-dasharray: 2.0,2.0;" x1="126.25" x2="481.25" y1="1987.793" y2="1987.793"/><text fill="#000000" font-family="sans-serif" font-size="32.5" lengthAdjust="spacingAndGlyphs" textLength="122.5" x="143.75" y="1975.6519">R-APDU</text><polygon fill="#A80036" points="1420,2053.6719,1445,2063.6719,1420,2073.6719,1430,2063.6719" style="stroke: #A80036; stroke-width: 2.5;"/><line style="stroke: #A80036; stroke-width: 2.5; stroke-dasharray: 2.0,2.0;" x1="508.75" x2="1435" y1="2063.6719" y2="2063.6719"/><text fill="#FF0000" font-family="sans-serif" font-size="32.5" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="162.5" x="526.25" y="2051.5308">smartCard</text><rect fill="#EEEEEE" height="7.5" style="stroke: #EEEEEE; stroke-width: 2.5;" width="4186.25" x="7.5" y="2136.6113"/><line style="stroke: #000000; stroke-width: 2.5;" x1="7.5" x2="4193.75" y1="2136.6113" y2="2136.6113"/><line style="stroke: #000000; stroke-width: 2.5;" x1="7.5" x2="4193.75" y1="2144.1113" y2="2144.1113"/><rect fill="#EEEEEE" height="60.8789" style="stroke: #000000; stroke-width: 5.0;" width="1072.5" x="1564.375" y="2108.6719"/><text fill="#000000" font-family="sans-serif" font-size="32.5" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="1027.5" x="1579.375" y="2152.4097">Execute Remote Service for a specific Observable Native Reader</text><line style="stroke: #A80036; stroke-width: 2.5;" x1="1475" x2="1580" y1="2250.4297" y2="2250.4297"/><line style="stroke: #A80036; stroke-width: 2.5;" x1="1580" x2="1580" y1="2250.4297" y2="2282.9297"/><line style="stroke: #A80036; stroke-width: 2.5;" x1="1477.5" x2="1580" y1="2282.9297" y2="2282.9297"/><polygon fill="#A80036" points="1502.5,2272.9297,1477.5,2282.9297,1502.5,2292.9297,1492.5,2282.9297" style="stroke: #A80036; stroke-width: 2.5;"/><text fill="#000000" font-family="sans-serif" font-size="32.5" lengthAdjust="spacingAndGlyphs" textLength="317.5" x="1492.5" y="2238.2886">prepare userInputData</text><line style="stroke: #A80036; stroke-width: 2.5;" x1="1475" x2="1580" y1="2358.8086" y2="2358.8086"/><line style="stroke: #A80036; stroke-width: 2.5;" x1="1580" x2="1580" y1="2358.8086" y2="2391.3086"/><line style="stroke: #A80036; stroke-width: 2.5;" x1="1477.5" x2="1580" y1="2391.3086" y2="2391.3086"/><polygon fill="#A80036" points="1502.5,2381.3086,1477.5,2391.3086,1502.5,2401.3086,1492.5,2391.3086" style="stroke: #A80036; stroke-width: 2.5;"/><text fill="#000000" font-family="sans-serif" font-size="32.5" lengthAdjust="spacingAndGlyphs" textLength="425" x="1492.5" y="2346.6675">NativeClientUtils.getService ()</text><polygon fill="#A80036" points="2142.5,2661.582,2167.5,2671.582,2142.5,2681.582,2152.5,2671.582" style="stroke: #A80036; stroke-width: 2.5;"/><line style="stroke: #A80036; stroke-width: 2.5;" x1="1475" x2="2157.5" y1="2671.582" y2="2671.582"/><text fill="#000000" font-family="sans-serif" font-size="32.5" lengthAdjust="spacingAndGlyphs" textLength="352.5" x="1492.5" y="2455.0464">executeRemoteService (</text><text fill="#000000" font-family="sans-serif" font-size="32.5" lengthAdjust="spacingAndGlyphs" textLength="385" x="1502.5" y="2495.9253">RemoteServiceParameters</text><text fill="#000000" font-family="sans-serif" font-size="32.5" lengthAdjust="spacingAndGlyphs" textLength="115" x="1522.5" y="2536.8042">.builder(</text><text fill="#0000FF" font-family="sans-serif" font-size="32.5" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="142.5" x="1637.5" y="2536.8042">serviceId</text><text fill="#000000" font-family="sans-serif" font-size="32.5" lengthAdjust="spacingAndGlyphs" textLength="120" x="1780" y="2536.8042">, reader)</text><text fill="#000000" font-family="sans-serif" font-size="32.5" lengthAdjust="spacingAndGlyphs" textLength="332.5" x="1522.5" y="2577.6831">.withInitialCardContent(</text><text fill="#FF0000" font-family="sans-serif" font-size="32.5" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="162.5" x="1855" y="2577.6831">smartCard</text><text fill="#000000" font-family="sans-serif" font-size="32.5" lengthAdjust="spacingAndGlyphs" textLength="10" x="2017.5" y="2577.6831">)</text><text fill="#000000" font-family="sans-serif" font-size="32.5" lengthAdjust="spacingAndGlyphs" textLength="282.5" x="1522.5" y="2618.562">.withUserInputData(</text><text fill="#008000" font-family="sans-serif" font-size="32.5" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="220" x="1805" y="2618.562">userInputData</text><text fill="#000000" font-family="sans-serif" font-size="32.5" lengthAdjust="spacingAndGlyphs" textLength="117.5" x="2025" y="2618.562">).build(),</text><text fill="#000000" font-family="sans-serif" font-size="32.5" lengthAdjust="spacingAndGlyphs" textLength="352.5" x="1502.5" y="2659.4409">classOfUserOutputData)</text><polygon fill="#A80036" points="2560,2696.582,2585,2706.582,2560,2716.582,2570,2706.582" style="stroke: #A80036; stroke-width: 2.5;"/><line style="stroke: #A80036; stroke-width: 2.5;" x1="2197.5" x2="2575" y1="2706.582" y2="2706.582"/><polygon fill="#A80036" points="2797.5,2772.4609,2822.5,2782.4609,2797.5,2792.4609,2807.5,2782.4609" style="stroke: #A80036; stroke-width: 2.5;"/><line style="stroke: #A80036; stroke-width: 2.5;" x1="2615" x2="2812.5" y1="2782.4609" y2="2782.4609"/><text fill="#000000" font-family="sans-serif" font-size="32.5" lengthAdjust="spacingAndGlyphs" textLength="90" x="2632.5" y="2770.3198">create</text><rect fill="#ADD8E6" height="79.0234" rx="12.5" ry="12.5" style="stroke: #A80036; stroke-width: 3.75;" width="622.5" x="2827.5" y="2726.582"/><text fill="#000000" font-family="sans-serif" font-size="35" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="587.5" x="2845" y="2780.415">RemoteServerObservableReader</text><line style="stroke: #A80036; stroke-width: 2.5;" x1="3766.25" x2="3741.25" y1="2888.9844" y2="2878.9844"/><line style="stroke: #A80036; stroke-width: 2.5;" x1="3766.25" x2="3741.25" y1="2888.9844" y2="2898.9844"/><line style="stroke: #A80036; stroke-width: 2.5;" x1="2602.5" x2="3768.75" y1="2888.9844" y2="2888.9844"/><text fill="#000000" font-family="sans-serif" font-size="32.5" lengthAdjust="spacingAndGlyphs" textLength="750" x="2620" y="2876.8433">notify (READER_CONNECTED, virtualReaderName)</text><polygon fill="#A80036" points="2642.5,2954.8633,2617.5,2964.8633,2642.5,2974.8633,2632.5,2964.8633" style="stroke: #A80036; stroke-width: 2.5;"/><line style="stroke: #A80036; stroke-width: 2.5;" x1="2627.5" x2="3768.75" y1="2964.8633" y2="2964.8633"/><text fill="#000000" font-family="sans-serif" font-size="32.5" lengthAdjust="spacingAndGlyphs" textLength="447.5" x="2657.5" y="2952.7222">getReader (virtualReaderName)</text><polygon fill="#A80036" points="3741.25,3030.7422,3766.25,3040.7422,3741.25,3050.7422,3751.25,3040.7422" style="stroke: #A80036; stroke-width: 2.5;"/><line style="stroke: #A80036; stroke-width: 2.5; stroke-dasharray: 2.0,2.0;" x1="2602.5" x2="3756.25" y1="3040.7422" y2="3040.7422"/><text fill="#000000" font-family="sans-serif" font-size="32.5" lengthAdjust="spacingAndGlyphs" textLength="185" x="2620" y="3028.6011">virtualReader</text><polygon fill="#A80036" points="3178.75,3106.6211,3153.75,3116.6211,3178.75,3126.6211,3168.75,3116.6211" style="stroke: #A80036; stroke-width: 2.5;"/><line style="stroke: #A80036; stroke-width: 2.5;" x1="3163.75" x2="3768.75" y1="3116.6211" y2="3116.6211"/><text fill="#000000" font-family="sans-serif" font-size="32.5" lengthAdjust="spacingAndGlyphs" textLength="205" x="3193.75" y="3104.48">getServiceId ()</text><polygon fill="#A80036" points="3741.25,3182.5,3766.25,3192.5,3741.25,3202.5,3751.25,3192.5" style="stroke: #A80036; stroke-width: 2.5;"/><line style="stroke: #A80036; stroke-width: 2.5; stroke-dasharray: 2.0,2.0;" x1="3138.75" x2="3756.25" y1="3192.5" y2="3192.5"/><text fill="#0000FF" font-family="sans-serif" font-size="32.5" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="142.5" x="3156.25" y="3180.3589">serviceId</text><line style="stroke: #A80036; stroke-width: 2.5;" x1="3796.25" x2="3901.25" y1="3309.2578" y2="3309.2578"/><line style="stroke: #A80036; stroke-width: 2.5;" x1="3901.25" x2="3901.25" y1="3309.2578" y2="3341.7578"/><line style="stroke: #A80036; stroke-width: 2.5;" x1="3798.75" x2="3901.25" y1="3341.7578" y2="3341.7578"/><polygon fill="#A80036" points="3823.75,3331.7578,3798.75,3341.7578,3823.75,3351.7578,3813.75,3341.7578" style="stroke: #A80036; stroke-width: 2.5;"/><text fill="#000000" font-family="sans-serif" font-size="32.5" lengthAdjust="spacingAndGlyphs" textLength="305" x="3813.75" y="3256.2378">Find ticketing service</text><text fill="#000000" font-family="sans-serif" font-size="32.5" lengthAdjust="spacingAndGlyphs" textLength="190" x="3813.75" y="3297.1167">to start using</text><text fill="#0000FF" font-family="sans-serif" font-size="32.5" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="142.5" x="4013.75" y="3297.1167">serviceId</text><rect fill="#EEEEEE" height="7.5" style="stroke: #EEEEEE; stroke-width: 2.5;" width="4186.25" x="7.5" y="3414.6973"/><line style="stroke: #000000; stroke-width: 2.5;" x1="7.5" x2="4193.75" y1="3414.6973" y2="3414.6973"/><line style="stroke: #000000; stroke-width: 2.5;" x1="7.5" x2="4193.75" y1="3422.1973" y2="3422.1973"/><rect fill="#EEEEEE" height="60.8789" style="stroke: #000000; stroke-width: 5.0;" width="452.5" x="1874.375" y="3386.7578"/><text fill="#000000" font-family="sans-serif" font-size="32.5" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="407.5" x="1889.375" y="3430.4956">Remote Ticketing Service</text><line style="stroke: #A80036; stroke-width: 2.5;" x1="3796.25" x2="3901.25" y1="3528.5156" y2="3528.5156"/><line style="stroke: #A80036; stroke-width: 2.5;" x1="3901.25" x2="3901.25" y1="3528.5156" y2="3561.0156"/><line style="stroke: #A80036; stroke-width: 2.5;" x1="3798.75" x2="3901.25" y1="3561.0156" y2="3561.0156"/><polygon fill="#A80036" points="3823.75,3551.0156,3798.75,3561.0156,3823.75,3571.0156,3813.75,3561.0156" style="stroke: #A80036; stroke-width: 2.5;"/><text fill="#000000" font-family="sans-serif" font-size="32.5" lengthAdjust="spacingAndGlyphs" textLength="325" x="3813.75" y="3516.3745">Start Ticketing Service</text><polygon fill="#A80036" points="3178.75,3667.7734,3153.75,3677.7734,3178.75,3687.7734,3168.75,3677.7734" style="stroke: #A80036; stroke-width: 2.5;"/><line style="stroke: #A80036; stroke-width: 2.5;" x1="3163.75" x2="3768.75" y1="3677.7734" y2="3677.7734"/><text fill="#000000" font-family="sans-serif" font-size="32.5" lengthAdjust="spacingAndGlyphs" textLength="300" x="3193.75" y="3624.7534">getInitialCardContent</text><text fill="#000000" font-family="sans-serif" font-size="32.5" lengthAdjust="spacingAndGlyphs" textLength="285" x="3203.75" y="3665.6323">(classOfSmartCard)</text><polygon fill="#A80036" points="3741.25,3743.6523,3766.25,3753.6523,3741.25,3763.6523,3751.25,3753.6523" style="stroke: #A80036; stroke-width: 2.5;"/><line style="stroke: #A80036; stroke-width: 2.5; stroke-dasharray: 2.0,2.0;" x1="3138.75" x2="3756.25" y1="3753.6523" y2="3753.6523"/><text fill="#FF0000" font-family="sans-serif" font-size="32.5" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="162.5" x="3156.25" y="3741.5112">smartCard</text><polygon fill="#A80036" points="3178.75,3860.4102,3153.75,3870.4102,3178.75,3880.4102,3168.75,3870.4102" style="stroke: #A80036; stroke-width: 2.5;"/><line style="stroke: #A80036; stroke-width: 2.5;" x1="3163.75" x2="3768.75" y1="3870.4102" y2="3870.4102"/><text fill="#000000" font-family="sans-serif" font-size="32.5" lengthAdjust="spacingAndGlyphs" textLength="250" x="3193.75" y="3817.3901">getUserInputData</text><text fill="#000000" font-family="sans-serif" font-size="32.5" lengthAdjust="spacingAndGlyphs" textLength="335" x="3203.75" y="3858.269">(classOfUserInputData)</text><polygon fill="#A80036" points="3741.25,3936.2891,3766.25,3946.2891,3741.25,3956.2891,3751.25,3946.2891" style="stroke: #A80036; stroke-width: 2.5;"/><line style="stroke: #A80036; stroke-width: 2.5; stroke-dasharray: 2.0,2.0;" x1="3138.75" x2="3756.25" y1="3946.2891" y2="3946.2891"/><text fill="#008000" font-family="sans-serif" font-size="32.5" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="220" x="3156.25" y="3934.1479">userInputData</text><polygon fill="#A80036" points="3178.75,4012.168,3153.75,4022.168,3178.75,4032.168,3168.75,4022.168" style="stroke: #A80036; stroke-width: 2.5;"/><line style="stroke: #A80036; stroke-width: 2.5;" x1="3163.75" x2="3768.75" y1="4022.168" y2="4022.168"/><text fill="#000000" font-family="sans-serif" font-size="32.5" lengthAdjust="spacingAndGlyphs" textLength="262.5" x="3193.75" y="4010.0269">addObserver (this)</text><polygon fill="#A80036" points="3741.25,4047.168,3766.25,4057.168,3741.25,4067.168,3751.25,4057.168" style="stroke: #A80036; stroke-width: 2.5;"/><line style="stroke: #A80036; stroke-width: 2.5; stroke-dasharray: 2.0,2.0;" x1="3138.75" x2="3756.25" y1="4057.168" y2="4057.168"/><line style="stroke: #A80036; stroke-width: 2.5;" x1="3796.25" x2="3901.25" y1="4133.0469" y2="4133.0469"/><line style="stroke: #A80036; stroke-width: 2.5;" x1="3901.25" x2="3901.25" y1="4133.0469" y2="4165.5469"/><line style="stroke: #A80036; stroke-width: 2.5;" x1="3798.75" x2="3901.25" y1="4165.5469" y2="4165.5469"/><polygon fill="#A80036" points="3823.75,4155.5469,3798.75,4165.5469,3823.75,4175.5469,3813.75,4165.5469" style="stroke: #A80036; stroke-width: 2.5;"/><text fill="#000000" font-family="sans-serif" font-size="32.5" lengthAdjust="spacingAndGlyphs" textLength="152.5" x="3813.75" y="4120.9058">continue...</text><path d="M45,4203.0469 L215,4203.0469 L215,4223.0469 L190,4248.0469 L32.5,4248.0469 L32.5,4215.5469 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 2.5;"/><rect fill="none" height="498.6523" rx="12.5" ry="12.5" style="stroke: #000000; stroke-width: 5.0;" width="4106.25" x="32.5" y="4203.0469"/><text fill="#000000" font-family="sans-serif" font-size="32.5" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="70" x="70" y="4239.2847">loop</text><text fill="#000000" font-family="sans-serif" font-size="27.5" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="242.5" x="252.5" y="4236.5942">[Card exchanges]</text><line style="stroke: #A80036; stroke-width: 2.5;" x1="3796.25" x2="3901.25" y1="4345.6836" y2="4345.6836"/><line style="stroke: #A80036; stroke-width: 2.5;" x1="3901.25" x2="3901.25" y1="4345.6836" y2="4378.1836"/><line style="stroke: #A80036; stroke-width: 2.5;" x1="3798.75" x2="3901.25" y1="4378.1836" y2="4378.1836"/><polygon fill="#A80036" points="3823.75,4368.1836,3798.75,4378.1836,3823.75,4388.1836,3813.75,4378.1836" style="stroke: #A80036; stroke-width: 2.5;"/><text fill="#000000" font-family="sans-serif" font-size="32.5" lengthAdjust="spacingAndGlyphs" textLength="295" x="3813.75" y="4292.6636">prepareCardRequest</text><text fill="#000000" font-family="sans-serif" font-size="32.5" lengthAdjust="spacingAndGlyphs" textLength="205" x="3823.75" y="4333.5425">(virtualReader)</text><polygon fill="#A80036" points="3178.75,4444.0625,3153.75,4454.0625,3178.75,4464.0625,3168.75,4454.0625" style="stroke: #A80036; stroke-width: 2.5;"/><line style="stroke: #A80036; stroke-width: 2.5;" x1="3163.75" x2="3768.75" y1="4454.0625" y2="4454.0625"/><text fill="#000000" font-family="sans-serif" font-size="32.5" lengthAdjust="spacingAndGlyphs" textLength="332.5" x="3193.75" y="4441.9214">processCardRequest ()</text><polygon fill="#A80036" points="153.75,4519.9414,128.75,4529.9414,153.75,4539.9414,143.75,4529.9414" style="stroke: #A80036; stroke-width: 2.5;"/><line style="stroke: #A80036; stroke-width: 2.5;" x1="138.75" x2="3123.75" y1="4529.9414" y2="4529.9414"/><text fill="#000000" font-family="sans-serif" font-size="32.5" lengthAdjust="spacingAndGlyphs" textLength="122.5" x="168.75" y="4517.8003">C-APDU</text><polygon fill="#A80036" points="3096.25,4595.8203,3121.25,4605.8203,3096.25,4615.8203,3106.25,4605.8203" style="stroke: #A80036; stroke-width: 2.5;"/><line style="stroke: #A80036; stroke-width: 2.5; stroke-dasharray: 2.0,2.0;" x1="126.25" x2="3111.25" y1="4605.8203" y2="4605.8203"/><text fill="#000000" font-family="sans-serif" font-size="32.5" lengthAdjust="spacingAndGlyphs" textLength="122.5" x="143.75" y="4593.6792">R-APDU</text><polygon fill="#A80036" points="3741.25,4671.6992,3766.25,4681.6992,3741.25,4691.6992,3751.25,4681.6992" style="stroke: #A80036; stroke-width: 2.5;"/><line style="stroke: #A80036; stroke-width: 2.5; stroke-dasharray: 2.0,2.0;" x1="3138.75" x2="3756.25" y1="4681.6992" y2="4681.6992"/><text fill="#000000" font-family="sans-serif" font-size="32.5" lengthAdjust="spacingAndGlyphs" textLength="132.5" x="3156.25" y="4669.5581">response</text><line style="stroke: #A80036; stroke-width: 2.5;" x1="3796.25" x2="3901.25" y1="4775.0781" y2="4775.0781"/><line style="stroke: #A80036; stroke-width: 2.5;" x1="3901.25" x2="3901.25" y1="4775.0781" y2="4807.5781"/><line style="stroke: #A80036; stroke-width: 2.5;" x1="3798.75" x2="3901.25" y1="4807.5781" y2="4807.5781"/><polygon fill="#A80036" points="3823.75,4797.5781,3798.75,4807.5781,3823.75,4817.5781,3813.75,4807.5781" style="stroke: #A80036; stroke-width: 2.5;"/><text fill="#000000" font-family="sans-serif" font-size="32.5" lengthAdjust="spacingAndGlyphs" textLength="350" x="3813.75" y="4762.937">prepare UserOutputData</text><polygon fill="#A80036" points="2642.5,4873.457,2617.5,4883.457,2642.5,4893.457,2632.5,4883.457" style="stroke: #A80036; stroke-width: 2.5;"/><line style="stroke: #A80036; stroke-width: 2.5;" x1="2627.5" x2="3768.75" y1="4883.457" y2="4883.457"/><text fill="#000000" font-family="sans-serif" font-size="32.5" lengthAdjust="spacingAndGlyphs" textLength="540" x="2657.5" y="4871.3159">terminateService (virtualReaderName,</text><text fill="#800080" font-family="sans-serif" font-size="32.5" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="245" x="3207.5" y="4871.3159">userOutputData</text><text fill="#000000" font-family="sans-serif" font-size="32.5" lengthAdjust="spacingAndGlyphs" textLength="10" x="3452.5" y="4871.3159">)</text><line style="stroke: #A80036; stroke-width: 5.0;" x1="3093.75" x2="3118.75" y1="4946.8359" y2="4971.8359"/><line style="stroke: #A80036; stroke-width: 5.0;" x1="3093.75" x2="3118.75" y1="4971.8359" y2="4946.8359"/><line style="stroke: #A80036; stroke-width: 2.5;" x1="2615" x2="3106.25" y1="4959.3359" y2="4959.3359"/><text fill="#000000" font-family="sans-serif" font-size="32.5" lengthAdjust="spacingAndGlyphs" textLength="435" x="2632.5" y="4947.1948">remove virtual reader if needed</text><polygon fill="#A80036" points="2225,4984.3359,2200,4994.3359,2225,5004.3359,2215,4994.3359" style="stroke: #A80036; stroke-width: 2.5;"/><line style="stroke: #A80036; stroke-width: 2.5; stroke-dasharray: 2.0,2.0;" x1="2210" x2="2600" y1="4994.3359" y2="4994.3359"/><polygon fill="#A80036" points="1502.5,5060.2148,1477.5,5070.2148,1502.5,5080.2148,1492.5,5070.2148" style="stroke: #A80036; stroke-width: 2.5;"/><line style="stroke: #A80036; stroke-width: 2.5; stroke-dasharray: 2.0,2.0;" x1="1487.5" x2="2182.5" y1="5070.2148" y2="5070.2148"/><text fill="#800080" font-family="sans-serif" font-size="32.5" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="245" x="1517.5" y="5058.0737">userOutputData</text><text fill="#888888" font-family="sans-serif" font-size="25" lengthAdjust="spacingAndGlyphs" textLength="1060" x="1570.625" y="5404.2139">Keyple Remote Plugin - RemoteServerPlugin API with an ObservableReader (22/10/2020)</text><!--MD5=[ad69dcad118bf3a3067d46379157cde0]
@startuml
footer
    Keyple Remote Plugin - RemoteServerPlugin API with an ObservableReader (22/10/2020)
end footer


skinparam Shadowing false
skinparam RoundCorner 10



participant "Card" as se

box "Client APP using Native Lib" #FEF9E7
participant "**ObservableReader**" as reader #LightBlue
participant "**Plugin**" as plugin #LightBlue
actor "**Ticketing Service**" as client
participant "**NativeClientService**" as nativeService #LightBlue
end box

box "Server APP using Virtual Lib" #FDF2E9
participant "**RemoteServerPlugin**" as remotePlugin #LightBlue
participant "**RemoteServerObservableReader**" as virtualReader #LightBlue
actor "**Remote Ticketing Service**:\n**<back:LightBlue>ObservablePlugin.PluginObserver**" as server
end box

== Virtual Lib Initialization ==

activate server #Pink
server -> remotePlugin ** : smartCardService.registerPlugin\n (RemoteServerPluginFactory...\n    .withPluginObserver (this)...)
server -> server : Awaiting receipt of\n a Plugin Event...

== Native Lib Initialization ==

activate client #Pink
client -> nativeService ** : NativeClientServiceFactory...
client -> plugin ** : smartCardService.registerPlugin\n (new XXXFactory())
activate plugin #LightBlue
plugin -> reader ** : create
return

== Native CardSelection ==

client -> client : Start Ticketing Service
client -> plugin : getReader (name)
activate plugin #LightBlue
return reader
client -> client : prepareCardSelection (reader)
client -> reader : setCardSelectionRequest ()
activate reader #LightBlue

activate se #LightYellow
se ->> reader : SE_MATCHED Event
reader -> se : C-APDU
se - -> reader : R-APDU
return <color:red>**smartCard**</color>

== Execute Remote Service for a specific Observable Native Reader ==

client -> client : prepare userInputData

client -> client : NativeClientUtils.getService ()
client -> nativeService : executeRemoteService (\n RemoteServiceParameters\n   .builder(<color:blue>**serviceId**</color>, reader)\n   .withInitialCardContent(<color:red>**smartCard**</color>)\n   .withUserInputData(<color:green>**userInputData**</color>).build(),\n classOfUserOutputData)
activate nativeService #LightBlue

nativeService -> remotePlugin
activate remotePlugin #LightBlue
remotePlugin -> virtualReader ** : create
remotePlugin ->> server : notify (READER_CONNECTED, virtualReaderName)
deactivate remotePlugin

server -> remotePlugin : getReader (virtualReaderName)
activate remotePlugin #LightBlue
return virtualReader
server -> virtualReader : getServiceId ()
activate virtualReader #LightBlue
return <color:blue>**serviceId**</color>
server -> server : Find ticketing service\nto start using <color:blue>**serviceId**</color>

== Remote Ticketing Service ==

server -> server : Start Ticketing Service
server -> virtualReader : getInitialCardContent\n (classOfSmartCard)
activate virtualReader #LightBlue
return <color:red>**smartCard**</color>
server -> virtualReader : getUserInputData\n (classOfUserInputData)
activate virtualReader #LightBlue
return <color:green>**userInputData**</color>
server -> virtualReader : addObserver (this)
activate virtualReader #LightBlue
return
server -> server : continue...

loop #FDF2E9 Card exchanges
    server -> server : prepareCardRequest\n (virtualReader)
    server -> virtualReader : processCardRequest ()
    activate virtualReader #LightBlue
    virtualReader -> se : C-APDU
    se - -> virtualReader : R-APDU
    return response
end loop

server -> server : prepare UserOutputData
server -> remotePlugin : terminateService (virtualReaderName, <color:purple>**userOutputData**</color>)
activate remotePlugin #LightBlue
remotePlugin -x virtualReader : remove virtual reader if needed

remotePlugin - -> nativeService
deactivate remotePlugin
nativeService - -> client : <color:purple>**userOutputData**</color>
deactivate nativeService

@enduml

PlantUML version 1.2020.09(Sun May 10 12:51:06 CEST 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.8+10-b944.34
Operating System: Windows 10
Default Encoding: Cp1252
Language: fr
Country: FR
--></g></svg>