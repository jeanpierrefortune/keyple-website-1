<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Source Themes Academic 4.8.0"><meta name=description content="Introduction Overview Since Keyple is supported by the Android operating system, developers can take advantage of this quick and easy to implement solution to provide SmartCard communication functionalities in their own mobile application."><link rel=alternate hreflang=en-us href=../../../docs/build-your-first-app/android-app/><link rel=preconnect href=https://fonts.gstatic.com crossorigin><meta name=theme-color content="#1D87BB"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css integrity="sha256-FMvZuGapsJLjouA6k7Eo2lusoAX9i0ShlWFG6qt7SLc=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/styles/github.min.css crossorigin=anonymous title=hl-light><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/styles/dracula.min.css crossorigin=anonymous title=hl-dark disabled><script src=https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js integrity="sha256-Md1qLToewPeKjfAHU1zyPwOutccPAm5tahnaw7Osw0A=" crossorigin=anonymous async></script><link rel=stylesheet href="https://fonts.googleapis.com/css?family=%7CWork+Sans:ital,wght@0,300;1,500&display=swap"><link rel=stylesheet href=../../../css/academic.css><link rel=manifest href=../../../index.webmanifest><link rel=icon type=image/png href=../../../images/icon_hu16db34b3636b127457de39ca2fab620f_9845_32x32_fill_lanczos_center_2.png><link rel=apple-touch-icon type=image/png href=../../../images/icon_hu16db34b3636b127457de39ca2fab620f_9845_192x192_fill_lanczos_center_2.png><link rel=canonical href=../../../docs/build-your-first-app/android-app/><meta property="twitter:card" content="summary"><meta property="twitter:site" content="@keyple_org"><meta property="twitter:creator" content="@keyple_org"><meta property="og:site_name" content="Eclipse Keyple"><meta property="og:url" content="/docs/build-your-first-app/android-app/"><meta property="og:title" content="Build your First Android Application | Eclipse Keyple"><meta property="og:description" content="Introduction Overview Since Keyple is supported by the Android operating system, developers can take advantage of this quick and easy to implement solution to provide SmartCard communication functionalities in their own mobile application."><meta property="og:image" content="/images/logo_hu673a59176cd62c570f44ed2728665b48_42188_300x300_fit_lanczos_2.png"><meta property="twitter:image" content="/images/logo_hu673a59176cd62c570f44ed2728665b48_42188_300x300_fit_lanczos_2.png"><meta property="og:locale" content="en-us"><meta property="article:modified_time" content="2020-11-06T15:21:43+01:00"><script src=https://cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.1/cookieconsent.min.js integrity="sha256-5VhCqFam2Cn+yjw61zbBNrbHVJ6SRydPeKopYlngbiQ=" crossorigin=anonymous></script><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.1/cookieconsent.min.css integrity="sha256-zQ0LblD/Af8vOppw18+2anxsuaz3pWYyVWi+bTvTH8Q=" crossorigin=anonymous><script>window.addEventListener("load",function(){window.cookieconsent.initialise({"palette":{"popup":{"background":"#1D87BB","text":"#FFFFFF"},"button":{"background":"#FFFFFF","text":"#1D87BB"}},"theme":"classic","type":"opt-in","content":{"header":'Cookiessss used on the website!',"message":"Some Eclipse Foundation pages use cookies to better serve you when you return to the site. You can set your browser to notify you before you receive a cookie or turn off cookies. If you do so, however, some areas of some sites may not function properly. To read Eclipse Foundation Privacy Policy ","allow":"Allow cookies","deny":"Decline","dismiss":"Got it!","link":"click here","href":'https://www.eclipse.org/legal/privacy.php'},})});</script><title>Build your First Android Application | Eclipse Keyple</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents><script>window.staDarkLightChooser=true;</script><script>const isSiteThemeDark=false;</script><script src=../../../js/load-theme.js></script><aside class=search-results id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class=col-6><h1>Search</h1></div><div class="col-6 col-search-close"><a class=js-search href=#><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box><input name=q id=search-query placeholder=Search... autocapitalize=off autocomplete=off autocorrect=off spellcheck=false type=search class=form-control></div></section><section class=section-search-results><div id=search-hits></div></section></div></aside><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=../../../><img src=../../../images/logo_hu673a59176cd62c570f44ed2728665b48_42188_0x70_resize_lanczos_2.png alt="Eclipse Keyple"></a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar aria-expanded=false aria-label="Toggle navigation">
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=../../../><img src=../../../images/logo_hu673a59176cd62c570f44ed2728665b48_42188_0x70_resize_lanczos_2.png alt="Eclipse Keyple"></a></div><div class="navbar-collapse main-menu-item collapse justify-content-center" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>What is Eclipse Keyple™</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=../../../what-is-keyple/main-features/><span>Keyple's main features</span></a>
<a class=dropdown-item href=../../../what-is-keyple/what-is-calypso/><span>What is Calypso®?</span></a>
<a class=dropdown-item href=../../../what-is-keyple/who-is-it-for/><span>Who is it for?</span></a>
<a class=dropdown-item href=../../../what-is-keyple/why-trust/><span>Why trust Eclipse Keyple™?</span></a>
<a class=dropdown-item href=../../../what-is-keyple/overview/><span>Overview</span></a></div></li><li class=nav-item><a class=nav-link href=../../../components/><span>Components</span></a></li><li class=nav-item><a class=nav-link href=../../../#news><span>News</span></a></li><li class=nav-item><a class="nav-link active" href=../../../docs/><span>Documentation</span></a></li><li class="nav-item dropdown"><a href=# class="nav-link dropdown-toggle" data-toggle=dropdown aria-haspopup=true><span>Support & Trainings</span><span class=caret></span></a><div class=dropdown-menu><a class=dropdown-item href=../../../support-trainings/cna/><span>Calypso Networks Association</span></a></div></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=Search><i class="fas fa-search" aria-hidden=true></i></a></li><li class="nav-item dropdown theme-dropdown"><a href=# class="nav-link js-theme-selector" data-toggle=dropdown aria-haspopup=true><i class="fas fa-palette" aria-hidden=true></i></a><div class=dropdown-menu><a href=# class="dropdown-item js-set-theme-light"><span>Light</span></a>
<a href=# class="dropdown-item js-set-theme-dark"><span>Dark</span></a>
<a href=# class="dropdown-item js-set-theme-auto"><span>Automatic</span></a></div></li></ul></div></nav><div class="container-fluid docs"><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 docs-sidebar"><form class="docs-search d-flex align-items-center"><button class="btn docs-toggle d-md-none p-0 mr-3" type=button data-toggle=collapse data-target=#docs-nav aria-controls=docs-nav aria-expanded=false aria-label="Toggle section navigation">
<span><i class="fas fa-bars"></i></span></button>
<input name=q type=search class=form-control placeholder=Search... autocomplete=off></form><nav class="collapse docs-links" id=docs-nav><ul class="nav docs-sidenav"><li><a href=../../../docs/></a></li><div class=docs-toc-item><a class=docs-toc-link href=../../../docs/architecture/><i class="fas fa-sitemap pr-1"></i>Architecture</a><ul class="nav docs-sidenav"><li><a href=../../../docs/architecture/keyple-global/>Global Architecture</a></li><li><a href=../../../docs/architecture/keyple-core/>Keyple Core</a></li><li><a href=../../../docs/architecture/keyple-calypso/>Keyple Calypso</a></li></ul></div><div class=docs-toc-item><a class=docs-toc-link href=../../../docs/build-your-first-app/><i class="fas fa-rocket pr-1"></i>Build your First App</a><ul class="nav docs-sidenav"><li><a href=../../../docs/build-your-first-app/java-app/>Java App</a></li><li class=active><a href=../../../docs/build-your-first-app/android-app/>Android App</a></li><li><a href=../../../docs/build-your-first-app/cpp-app/>C++ App</a></li></ul></div><li><a href=../../../docs/developer-guides/ticketing-application/connect-a-plugin/>Connect a plugin</a></li><div class=docs-toc-item><a class=docs-toc-link href=../../../docs/developer-guide/><i class="fas fa-chalkboard-teacher pr-1"></i>Developer Guides</a><ul class="nav docs-sidenav"><li><a href=../../../docs/developer-guide/develop-ticketing-app-local/>Develop a Local Ticketing Application</a></li><li><a href=../../../docs/developer-guide/develop-ticketing-app-remote/>Develop a Remote Ticketing Application</a></li><li><a href=../../../docs/developer-guide/develop-plugin/>Develop a Plugin</a></li><li><a href=../../../docs/developer-guide/develop-extension/>Develop an Extension</a></li><li><a href=../../../docs/developer-guide/migration-0.8.1-to-0.9.0/>Keyple Java 0.8.1 to 0.9.0</a></li></ul></div><div class=docs-toc-item><a class=docs-toc-link href=../../../docs/api-reference/><i class="fas fa-plug pr-1"></i>API Reference</a></div></ul></nav></div><div class="d-none d-xl-block col-xl-2 docs-toc"><ul class="nav toc-top"><li><a href=# id=back_to_top class=docs-toc-title>Contents</a></li></ul><nav id=TableOfContents><ul><li><a href=#overview>Overview</a></li><li><a href=#what-to-we-need-for-this-guide>What to we need for this guide?</a></li></ul><ul><li><a href=#application-setup>Application setup</a></li><li><a href=#sdk-integration>SDK Integration</a><ul><li><a href=#keyple-core>Keyple Core</a></li><li><a href=#keyple-plugins>Keyple Plugins</a></li><li><a href=#keyple-calypso>Keyple Calypso</a></li></ul></li></ul><ul><li><a href=#initializing-the-sdk>Initializing the SDK</a><ul><li><a href=#register-a-plugin>Register a plugin</a></li><li><a href=#unregister-a-plugin>Unregister a plugin</a></li></ul></li><li><a href=#retrieve-a-specific-reader>Retrieve a specific reader</a></li><li><a href=#add-observer-to-handle-nfc-events>Add observer to handle NFC events</a></li><li><a href=#activate-card-detection>Activate Card detection</a></li><li><a href=#deactivate-card-detection>Deactivate Card detection</a></li><li><a href=#handling-a-calypso-po>Handling a Calypso PO</a><ul><li><a href=#calypso-selection-api>Calypso Selection API</a></li><li><a href=#reading-environment-and-usage>Reading Environment and usage</a></li></ul></li><li><a href=#full-code>Full code</a></li></ul></nav></div><main class="col-12 col-md-9 col-xl-8 py-md-3 pl-md-5 docs-content" role=main><article class=article><div class=docs-article-container><h1>Build your First Android Application</h1><div class=article-style><h1 id=introduction>Introduction</h1><h2 id=overview>Overview</h2><p><strong>Since Keyple is supported by the Android operating system, developers can take advantage of this quick and easy to implement solution to provide SmartCard communication functionalities in their own mobile application.</strong></p><p>For exemple, Keyple could be used to facilitate the development of a ticketing application based of the use of conteners on a SIM card and relying on
<a href=https://developer.android.com/reference/android/se/omapi/package-summary target=_blank rel=noopener>Android SE OMAPI</a>.
Keyple could also be used to develop an application reading SmartCard content through NFC using
<a href=https://developer.android.com/guide/topics/connectivity/nfc/advanced-nfc target=_blank rel=noopener>Android NFC</a>.</p><figure><a data-fancybox href=../../../media/android-app/component/Android_App_Overview.png><img src=../../../media/android-app/component/Android_App_Overview.png alt></a></figure><p>As Keyple request low level reader access, the key features of Keyple SDK relies on components called &lsquo;Plugins&rsquo;. These are the plugins that allow access to the hardware functionality of the terminal by using the native Android SDK or the terminal manufacturer&rsquo;s own custom SDKs.</p><p>This guide will describe how to start a ticketing application using Keyple SDK and Android NFC plugin to read the content of a Calypso SmartCard. As we want to focus on Keyple integration, the Android application architecture will remain the simplest as possible.</p><h2 id=what-to-we-need-for-this-guide>What to we need for this guide?</h2><ul><li>Retail Device with NFC powered by android.nfc library (integrated into standard Android SDK).</li><li>Android OS 19+</li><li>A NFC SmartCard with Calypso PO</li></ul><h1 id=integration>Integration</h1><h2 id=application-setup>Application setup</h2><p>Like for any other Android NFC Application, we need to declare items in the application manifest.</p><pre><code class=language-xml>&lt;manifest xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&gt;
    ...
    &lt;uses-permission android:name=&quot;android.permission.NFC&quot; /&gt;
    &lt;uses-feature android:name=&quot;android.hardware.nfc&quot; android:required=&quot;true&quot; /&gt;
    ...
&lt;/manifest&gt;
</code></pre><h2 id=sdk-integration>SDK Integration</h2><h3 id=keyple-core>Keyple Core</h3><p>This high-level API is convenient for developers implementing smart card processing application for terminal interfaced
with smart card readers. Access to the readers is provided by the plugins.</p><p>To use Keyple core API (and in fact, anything keyple&rsquo;s related) import the jar within the gradle dependencies of your
Android application.</p><pre><code class=language-gradle>implementation &quot;org.eclipse.keyple:keyple-java-core:$keyple_version&quot;
</code></pre><p>Please refer to Architecture/Keyle Core</p><h3 id=keyple-plugins>Keyple Plugins</h3><p>There are many Keyple plugins available, the one to use depends on the device and ticketing tools you are aiming to
use.</p><p>To use the NFC plugin simply import it within the gradle dependencies of your Android application.</p><pre><code class=language-gradle>implementation &quot;org.eclipse.keyple:keyple-android-nfc:$keyple_version&quot;
</code></pre><h3 id=keyple-calypso>Keyple Calypso</h3><p>The Keyple Calypso User API is an extension of the Keyple Core User API to manage Calypso Portable Objects.</p><p>Please refer to Architecture/Keyle Calypso</p><p>To use Keyple Calypso User API simply import the jar within the gradle dependencies of your Android application.</p><pre><code class=language-gradle>implementation &quot;org.eclipse.keyple:keyple-java-calypso:$keyple_version&quot;
</code></pre><h1 id=lets-code>Let&rsquo;s code</h1><h2 id=initializing-the-sdk>Initializing the SDK</h2><h3 id=register-a-plugin>Register a plugin</h3><p>In order to setup Keyple, we need to register at least one plugin. Here we register our NFC plugin. To do so, we use the singleton SmartCardService and the plugin Factory. (See plugin development guide to know more about plugins)</p><pre><code class=language-kotlin>override fun onCreate(savedInstanceState: Bundle?) {
    super.onCreate(savedInstanceState)
    /* register Android NFC Plugin to the SmartCardService */
    try {
        SmartCardService.getInstance().registerPlugin(AndroidNfcPluginFactory())
    }catch (e: KeypleException){
        /* do something with it */
    }
}
</code></pre><p>Note: Plugins Factory&rsquo;s initialisation could request more steps to execute before passing it to registerPlugin(). It depends on plugins, please check the documentation or usage exemple of desired plugin.</p><h3 id=unregister-a-plugin>Unregister a plugin</h3><p>Clean resources.</p><pre><code class=language-kotlin>override fun onDestroy() {
    super.onCreate(savedInstanceState)
    /* Unregister Android NFC Plugin to the SmartCardService */
    try {
        SmartCardService.getInstance().unregisterPlugin(AndroidNfcPlugin.PLUGIN_NAME)
    }catch (e: KeypleException){
        /* do something with it */
    }
    super.onDestroy()
}
</code></pre><h2 id=retrieve-a-specific-reader>Retrieve a specific reader</h2><p>With the plugin registered we can retrieve all instances of the component mapping the SmartCard readers. Here we want to retrieve the NFC reader.</p><pre><code class=language-kotlin>//We keep a reference to the reader for later use
private lateinit var reader: AndroidNfcReader
...
//PLUGIN_NAME and READER_NAME are constants provided by the used Keyple plugin 
reader = plugin.readers[AndroidNfcReader.READER_NAME] as AndroidNfcReader
</code></pre><h2 id=add-observer-to-handle-nfc-events>Add observer to handle NFC events</h2><p>When native NFC is activated on an Android device, the OS dispatches insertion events occurring in the NFC detection field. In our application, we need detect it in order to proceed to exchanges with the SmartCard.</p><pre><code class=language-kotlin>//To keep it simple we choose to have our MainActivity implementing ObservableReader.ReaderObserver 
//interface. 
class MainActivity : AppCompatActivity(), ObservableReader.ReaderObserver {
    ...        
    reader.addObserver(this)
    ...
    //Belongs to ObservableReader.ReaderObserver
    //NFC Reader events will be received here.
    //this method is not triggered in UI thread
    override fun update(event: ReaderEvent) {
        if(event.eventType == ReaderEvent.EventType.CARD_INSERTED){
            //We'll select PO when SmartCard is presented in field
            //Method handlePo is described below
            handlePo()
        }
    }
}
</code></pre><p>Now we have an access to our NFC Reader, we can activate Card Detection.</p><h2 id=activate-card-detection>Activate Card detection</h2><p>We will start detection as soon as our application comes in foreground and stop when application go background.</p><pre><code class=language-kotlin>class MainActivity : AppCompatActivity(), ObservableReader.ReaderObserver {
    override fun onResume() {
        super.onResume()
        reader?.let {
            //Set Keyple in a detection mode 
            //We choose to stop detection as soon as one card is detected
            it.startCardDetection(ObservableReader.PollingMode.SINGLESHOT)
            //Activate NFC detection (To be removed soon for merge with below step)
            it.enableNFCReaderMode(this)
        }
    }
}
</code></pre><h2 id=deactivate-card-detection>Deactivate Card detection</h2><pre><code class=language-kotlin>class MainActivity : AppCompatActivity(), ObservableReader.ReaderObserver {
    override fun onPause() {
        reader?.let {
            it.disableNFCReaderMode(this)
            it.stopCardDetection()
        }
        super.onPause()
    }
}
</code></pre><p>Now we can detect when a SmartCard is presented in the field, we can proceed to card application selection and data reading.</p><h2 id=handling-a-calypso-po>Handling a Calypso PO</h2><h3 id=calypso-selection-api>Calypso Selection API</h3><p>With Keyple, PO selection and FCI retrieving can be done using only Keyple Core, but Keyple Calypso API provides specific tools to handle Calypso POs and make the process a bit more simple.</p><pre><code class=language-kotlin>fun handlePo(){
    reader?.let {
        //check if card is in the NFC field
        if(it.isCardPresent){

            //Instanciate class handling card selection process 
            val cardSelection = CardSelection()
            //We only want to select the PO so we choose to close communication channel once 
            //selection is done
            cardSelection.prepareReleaseChannel()

            //We build a selection request managing specific characteristics of Calypso POs
            val poSelectionRequest = PoSelectionRequest(
                PoSelector
                    .builder()
                    //Smarcard standard protocol
                    .cardProtocol(ContactlessCardCommonProtocols.ISO_14443_4.name)
                    .aidSelector(
                        CardSelector.AidSelector.builder()
                            .aidToSelect(YOUR_AID)  //Set the AID of your Calypso PO
                            //indicates how to carry out the file occurrence in accordance with 
                            //ISO7816-4
                            .fileOccurrence(CardSelector.AidSelector.FileOccurrence.FIRST)
                            //indicates which template is expected in accordance with ISO7816-4
                            .fileControlInformation(
                                CardSelector.AidSelector.FileControlInformation.FCI)
                            .build()
                    ).build())
            cardSelection.prepareSelection(poSelectionRequest)

            //Proceed to selection using the reader
            val selectionResult = cardSelection.processExplicitSelection(it)

            runOnUiThread {
                //We check the selection result and read the FCI
                if(selectionResult.hasActiveSelection()){
                    val matchedSmartCard = selectionResult.activeSmartCard
                    val fci = matchedSmartCard.fciBytes
                    Toast.makeText(this, String.format(&quot;Selected, Fci %s&quot;, 
                        ByteArrayUtil.toHex(fci)), Toast.LENGTH_LONG).show()
                }else {
                    Toast.makeText(this, 
                        String.format(&quot;Not selected&quot;), Toast.LENGTH_SHORT).show()
                }
            }
        }
    }
}
</code></pre><p>Now we&rsquo;ve seen we can select our PO we can retrieve more data from it.</p><h3 id=reading-environment-and-usage>Reading Environment and usage</h3><p>In the below example we&rsquo;ll read Environment and Usage data of an Hoplink container.</p><pre><code class=language-kotlin>    ...
    //Data related to Hoplink
    val poAid= &quot;A000000291A000000191&quot;
    val sfiHoplinkEFEnvironment = 0x14.toByte()
    val sfiHoplinkEFUsage = 0x1A.toByte()
    ...
    private fun handlePo(){
        ...
        //Prepare the reading order. We'll read the first record of the EF
        //specified by its SFI. This reading will be done within explicit selection.
        poSelectionRequest.prepareReadRecordFile(sfiHoplinkEFEnvironment, 1)
        poSelectionRequest.prepareReadRecordFile(sfiHoplinkEFUsage, 1)
        ...
        
        //Hoplink is a Calypso PO, we can cast the SmartCard
        //with CalypsoPo class, representing the PO content.
        val calypsoPO = selectionResult.activeSmartCard as CalypsoPo
        val environment = calypsoPO.getFileBySfi(sfiHoplinkEFEnvironment)
        val usage = calypsoPO.getFileBySfi(sfiHoplinkEFUsage)
        Toast.makeText(this, String.format(&quot;Environment %s&quot;,
            ByteArrayUtil.toHex(environment.data.content)), Toast.LENGTH_SHORT).show()
        Toast.makeText(this, String.format(&quot;Usage %s&quot;,
            ByteArrayUtil.toHex(usage.data.content)), Toast.LENGTH_SHORT).show()

    }
</code></pre><h2 id=full-code>Full code</h2><pre><code class=language-xml>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;manifest xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    package=&quot;org.eclipse.keyple.android.quickstart&quot;&gt;

    &lt;uses-permission android:name=&quot;android.permission.NFC&quot; /&gt;

    &lt;uses-feature
        android:name=&quot;android.hardware.nfc&quot;
        android:required=&quot;true&quot; /&gt;

    &lt;application
        android:allowBackup=&quot;true&quot;
        android:screenOrientation=&quot;portrait&quot;
        android:icon=&quot;@mipmap/ic_launcher&quot;
        android:label=&quot;@string/app_name&quot;
        android:roundIcon=&quot;@mipmap/ic_launcher_round&quot;
        android:supportsRtl=&quot;true&quot;
        android:theme=&quot;@style/AppTheme&quot;&gt;
        &lt;activity android:name=&quot;.MainActivity&quot;&gt;
            &lt;intent-filter&gt;
                &lt;action android:name=&quot;android.intent.action.MAIN&quot; /&gt;

                &lt;category android:name=&quot;android.intent.category.LAUNCHER&quot; /&gt;
            &lt;/intent-filter&gt;
        &lt;/activity&gt;
    &lt;/application&gt;

&lt;/manifest&gt;
</code></pre><pre><code class=language-kotlin>class MainActivity : AppCompatActivity(), ObservableReader.ReaderObserver {

    private var reader: AndroidNfcReader? = null
    val poAid= &quot;A000000291A000000191&quot;
    val sfiHoplinkEFEnvironment = 0x14.toByte()
    val sfiHoplinkEFUsage = 0x1A.toByte()

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)
        try {
            val plugin = SmartCardService.getInstance().registerPlugin(AndroidNfcPluginFactory())
            val reader = plugin.readers[AndroidNfcReader.READER_NAME] as AndroidNfcReader
            reader.addObserver(this)
            reader.activateProtocol(ContactlessCardCommonProtocols.ISO_14443_4.name, ContactlessCardCommonProtocols.ISO_14443_4.name)
            this.reader = reader
        }catch (e: KeypleException){
            Timber.e(e)
            Toast.makeText(this, String.format(&quot;Error: %s&quot;, e.message), Toast.LENGTH_LONG).show()
        }
    }

    override fun onResume() {
        super.onResume()
        reader?.let {
            it.startCardDetection(ObservableReader.PollingMode.SINGLESHOT)
            it.enableNFCReaderMode(this)
            Toast.makeText(this, String.format(&quot;Hunt enabled&quot;), Toast.LENGTH_SHORT).show()
        }
    }

    override fun onPause() {
        reader?.let {
            it.disableNFCReaderMode(this)
            it.stopCardDetection()
        }
        super.onPause()
    }

    override fun onDestroy() {
        SmartCardService.getInstance().unregisterPlugin(AndroidNfcPlugin.PLUGIN_NAME)
        reader = null
        super.onDestroy()
    }

    override fun update(event: ReaderEvent) {
        Timber.d(&quot;Event: %s&quot;, event.eventType.name)
        runOnUiThread {
            Toast.makeText(this, String.format(&quot;Event: %s&quot;, event.eventType.name),
                Toast.LENGTH_SHORT).show()
        }
        if(event.eventType == ReaderEvent.EventType.CARD_INSERTED){
            handlePo()
        }
    }

    //With Calypso API
    private fun handlePo(){
        reader?.let {
            if(it.isCardPresent){
                val cardSelection = CardSelection()
                cardSelection.prepareReleaseChannel()
                val poSelectionRequest = PoSelectionRequest(
                        PoSelector
                                .builder()
                                .cardProtocol(ContactlessCardCommonProtocols.ISO_14443_4.name)
                                .aidSelector(
                                        CardSelector.AidSelector.builder()
                                                .aidToSelect(poAid)
                                                .fileOccurrence(
                                                    CardSelector.AidSelector.FileOccurrence.FIRST)
                                                .fileControlInformation(
                                                    CardSelector.AidSelector.FileControlInformation.FCI)
                                                .build()
                                ).build())

                cardSelection.prepareSelection(poSelectionRequest)

                //Prepare the reading order. We'll read the first record of the EF
                //specified by his SFI. This reading will be done with selection.
                poSelectionRequest.prepareReadRecordFile(sfiHoplinkEFEnvironment, 1)
                poSelectionRequest.prepareReadRecordFile(sfiHoplinkEFUsage, 1)

                //Selection and file reading will be done here
                val selectionResult = cardSelection.processExplicitSelection(it)

                runOnUiThread {
                    if(selectionResult.hasActiveSelection()){
                        val matchedSmartCard = selectionResult.activeSmartCard
                        val fci = matchedSmartCard.fciBytes
                        Toast.makeText(this, String.format(&quot;Selected, Fci %s&quot;,
                            ByteArrayUtil.toHex(fci)), Toast.LENGTH_SHORT).show()

                        //Hoplink is a Calypso PO, we can cast the SmartCard
                        //with CalypsoPo class, representing the PO content.
                        val calypsoPO = selectionResult.activeSmartCard as CalypsoPo
                        val environment = calypsoPO.getFileBySfi(sfiHoplinkEFEnvironment)
                        val usage = calypsoPO.getFileBySfi(sfiHoplinkEFUsage)
                        Toast.makeText(this, String.format(&quot;Environment %s&quot;,
                            ByteArrayUtil.toHex(environment.data.content)), Toast.LENGTH_SHORT).show()
                        Toast.makeText(this, String.format(&quot;Usage %s&quot;,
                            ByteArrayUtil.toHex(usage.data.content)), Toast.LENGTH_SHORT).show()
                    }else {
                        Toast.makeText(this, String.format(&quot;Not selected&quot;), Toast.LENGTH_SHORT).show()
                    }
                }
            }
        }
    }
}
</code></pre><h1 id=faq>FAQ:</h1><p><strong>How to fix &ldquo;More than one file was found with OS independent path &lsquo;META-INF/NOTICE.md&rsquo;."</strong></p><p>Add lines below to your :app build.gradle file</p><pre><code class=language-gradle>android{
    packagingOptions {
        exclude 'META-INF/NOTICE.md'
    }
}
</code></pre><p><strong>Where can I see more examples</strong></p><p>Android native plugins are provided with example applications. Check it to see more use cases:
<a href=https://github.com/eclipse/keyple-java/tree/master/java/example target=_blank rel=noopener>Examples</a></p></div><div class=article-widget><div class=post-nav><div class=post-nav-item><div class=meta-nav>Previous</div><a href=../../../docs/build-your-first-app/java-app/ rel=next>Build your First Java Application</a></div><div class=post-nav-item><div class=meta-nav>Next</div><a href=../../../docs/build-your-first-app/cpp-app/ rel=prev>Build your First C++ Application</a></div></div></div></div><div class=body-footer><p>Last updated on Fri, Nov 6, 2020</p></div></article><footer class=site-footer><div class=container><div class="row featurette"><div class="col-12 col-sm-4"><h4>More</h4><ul><li><a href=https://github.com/eclipse/keyple title="View Source Code on GitHub"><i class="fab fa-github"></i>GitHub Repository</a></li><li><a href=https://accounts.eclipse.org/mailing-list/keyple-user title="Keyple progress information and user discussions"><i class="fas fa-envelope"></i>User mailing list</a></li><li><a href=https://accounts.eclipse.org/mailing-list/keyple-dev title="Keyple developer discussions"><i class="fas fa-envelope"></i>Developer mailing list</a></li></ul></div><div class="col-12 col-sm-4"><h4>Eclipse Foundation</h4><ul><li><a href=https://www.eclipse.org/org/>About Eclipse Foundation</a></li><li><a href=https://www.eclipse.org/org/foundation/contact.php>Contact Eclipse Foundation</a></li><li><a href=https://www.eclipse.org/donate>Donate</a></li><li><a href=https://www.eclipse.org/membership>Members</a></li><li><a href=https://www.eclipse.org/org/documents/>Governance</a></li><li><a href=https://www.eclipse.org/org/documents/Community_Code_of_Conduct.php>Code of Conduct</a></li><li><a href=https://www.eclipse.org/artwork/>Logo and Artwork</a></li><li><a href=https://www.eclipse.org/org/foundation/directors.php></a></li></ul></div><div class="col-12 col-sm-4"><h4>Legal</h4><ul><li><a href=https://www.eclipse.org/legal/privacy.php>Privacy Policy</a></li><li><a href=https://www.eclipse.org/legal/termsofuse.php>Terms of Use</a></li><li><a href=https://www.eclipse.org/legal/copyright.php>Copyright Agent</a></li><li><a href=https://www.eclipse.org/legal/epl-2.0/>Eclipse Public License</a></li><li><a href=https://www.eclipse.org/legal/>Legal Resources</a></li><li><a href=https://eclipse.org/security/ target=_blank>Report a Vulnerability</a></li></ul></section></div></div><p class=powered-by>Copyright © Eclipse Foundation, Inc. All Rights Reserved.</p><p class=powered-by>Powered by the
<a href=https://wowchemy.com/ target=_blank rel=noopener>Wowchemy theme</a>
for
<a href=https://gohugo.io target=_blank rel=noopener>Hugo</a>.
<span class=float-right aria-hidden=true><a href=# class=back-to-top><span class=button_icon><i class="fas fa-chevron-up fa-2x"></i></span></a></span></p></footer></main></div></div><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/instant.page/5.1.0/instantpage.min.js integrity="sha512-1+qUtKoh9XZW7j+6LhRMAyOrgSQKenQ4mluTR+cvxXjP1Z54RxZuzstR/H9kgPXQsVB8IW7DMDFUJpzLjvhGSQ==" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/highlight.min.js integrity="sha512-7t8APmYpzEsZP7CYoA7RfMPV9Bb+PJHa9x2WiUnDXZx3XHveuyWUtvNOexhkierl5flZ3tr92dP1mMS+SGlD+A==" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/languages/java.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.2/languages/kotlin.min.js></script><script>const code_highlighting=true;</script><script>const search_config={"indexURI":"/index.json","minLength":1,"threshold":0.3};const i18n={"no_results":"No results found","placeholder":"Search...","results":"results found"};const content_type={'post':"Posts",'project':"Projects",'publication':"Publications",'talk':"Talks",'slides':"Slides"};</script><script src=https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.1/anchor.min.js integrity="sha256-pB/deHc9CGfFpJRjC43imB29Rse8tak+5eXqntO94ck=" crossorigin=anonymous></script><script>anchors.add();</script><script id=search-hit-fuse-template type=text/x-template>
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script><script src=https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin=anonymous></script><script src=../../../js/academic.min.fefc2dabdfd5f36e9e1ca94b7be9ea53.js></script><div id=modal class="modal fade" role=dialog><div class=modal-dialog><div class=modal-content><div class=modal-header><h5 class=modal-title>Cite</h5><button type=button class=close data-dismiss=modal aria-label=Close>
<span aria-hidden=true>&#215;</span></button></div><div class=modal-body><pre><code class="tex hljs"></code></pre></div><div class=modal-footer><a class="btn btn-outline-primary my-1 js-copy-cite" href=# target=_blank><i class="fas fa-copy"></i>Copy</a>
<a class="btn btn-outline-primary my-1 js-download-cite" href=# target=_blank><i class="fas fa-download"></i>Download</a><div id=modal-error></div></div></div></div></div></body></html>